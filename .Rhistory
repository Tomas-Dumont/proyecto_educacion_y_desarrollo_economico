panel_raw <- df
# Análisis de datos faltantes y outliers
library(dplyr)
library(tidyr)
library(readr)
install.packages("readr")
# Análisis de datos faltantes y outliers
install.packages("readr")
library(dplyr)
library(tidyr)
library(readr)
# ---------------------------------------------------------------------
# 1. Cargar datos limpios
# ---------------------------------------------------------------------
df <- read.csv("data/clean/wb_global_clean.csv")
setwd("~/Desktop/proyecto_educacion_y_crecimiento_argentina")
# Análisis de datos faltantes y outliers
install.packages("readr")
library(dplyr)
library(tidyr)
library(readr)
# ---------------------------------------------------------------------
# 1. Cargar datos limpios
# ---------------------------------------------------------------------
df <- read.csv("data/clean/wb_global_clean.csv")
# Guardar copia ANTES de cualquier decisión (para tabla antes/después)
panel_raw <- df
# Variables numéricas de interés
vars_num <- c("gdp_pc_ppp", "edu_exp_gdp", "tertiary_enr", "literacy")
# ---------------------------------------------------------------------
# 2. RESUMEN DE MISSING POR VARIABLE
# ---------------------------------------------------------------------
n_total <- nrow(df)
missing_resumen <- data.frame(
variable     = names(df),
n_missing    = sapply(df, function(x) sum(is.na(x))),
prop_missing = round(sapply(df, function(x) mean(is.na(x))) * 100, 2)
)
write.csv(missing_resumen,
"output/tables/missing_resumen_completo.csv",
row.names = FALSE)
missing_modelo <- missing_resumen %>%
filter(variable %in% vars_num)
write.csv(missing_modelo,
"output/tables/missing_variables_modelo.csv",
row.names = FALSE)
# ---------------------------------------------------------------------
# 3. MISSING POR AÑO Y GRUPO DE DESARROLLO
# ---------------------------------------------------------------------
df <- df %>%
mutate(
grupo_desarrollo = ifelse(
income == "High income",
"Países de altos ingresos",
"Países emergentes y en desarrollo"
)
)
missing_por_anio_grupo <- df %>%
group_by(grupo_desarrollo, year) %>%
summarise(
n_obs             = n(),
miss_gdp_pc_ppp   = sum(is.na(gdp_pc_ppp)),
miss_edu_exp_gdp  = sum(is.na(edu_exp_gdp)),
miss_tertiary_enr = sum(is.na(tertiary_enr)),
miss_literacy     = sum(is.na(literacy)),
.groups = "drop"
)
write.csv(missing_por_anio_grupo,
"output/tables/missing_por_anio_y_grupo.csv",
row.names = FALSE)
# ---------------------------------------------------------------------
# 4. DETECCIÓN DE OUTLIERS (regla IQR por año y variable)
# ---------------------------------------------------------------------
df_long <- df %>%
select(country, year, all_of(vars_num)) %>%
pivot_longer(
cols = all_of(vars_num),
names_to = "variable",
values_to = "valor"
)
bounds <- df_long %>%
group_by(variable, year) %>%
summarise(
q1    = quantile(valor, 0.25, na.rm = TRUE),
q3    = quantile(valor, 0.75, na.rm = TRUE),
iqr   = q3 - q1,
lower = q1 - 1.5 * iqr,
upper = q3 + 1.5 * iqr,
.groups = "drop"
)
df_long_out <- df_long %>%
left_join(bounds, by = c("variable", "year")) %>%
mutate(
es_outlier = ifelse(!is.na(valor) & (valor < lower | valor > upper),
TRUE, FALSE)
)
outliers_detectados <- df_long_out %>%
filter(es_outlier)
write.csv(outliers_detectados,
"output/tables/outliers_detectados_iqr.csv",
row.names = FALSE)
# ---------------------------------------------------------------------
# 5. DECISIÓN DE LIMPIEZA PARA EL MODELO
# ---------------------------------------------------------------------
# Usamos CASOS COMPLETOS para generar panel_clean
# (esto debe mencionarse en el informe como MCAR/MAR y sesgos posibles)
panel_clean <- df %>%
drop_na(gdp_pc_ppp, edu_exp_gdp, tertiary_enr, literacy)
# ---------------------------------------------------------------------
# 6. TABLA ANTES VS DESPUÉS (impacto de la limpieza)
# ---------------------------------------------------------------------
vars_desc <- c("gdp_pc_ppp", "edu_exp_gdp", "tertiary_enr")
desc_before <- panel_raw %>%
summarise(across(
all_of(vars_desc),
list(mean = ~mean(.x, na.rm = TRUE),
sd = ~sd(.x, na.rm = TRUE),
median = ~median(.x, na.rm = TRUE)),
.names = "{.col}_{.fn}"
)) %>% mutate(stage = "antes_limpieza")
desc_after <- panel_clean %>%
summarise(across(
all_of(vars_desc),
list(mean = ~mean(.x, na.rm = TRUE),
sd = ~sd(.x, na.rm = TRUE),
median = ~median(.x, na.rm = TRUE)),
.names = "{.col}_{.fn}"
)) %>% mutate(stage = "despues_limpieza")
tabla_impacto <- bind_rows(desc_before, desc_after)
write.csv(tabla_impacto,
"output/tables/tabla_antes_despues_missing_outliers.csv",
row.names = FALSE)
write.csv(panel_clean, "data/processed/panel_clean.csv", row.names = FALSE)
